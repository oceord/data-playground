# Query statements

> [!NOTE]
> These query statements were generated by [phind](https://www.phind.com/) to explore different aspects of MongoDB, including basic operations, aggregation pipelines, indexing strategies, and performance.

1. **Find All Documents**: Retrieve all documents in the user_events collection.

```shell
db.user_events.find({})
```

2. **Find by Event Type**: Find events of a specific type.

```shell
db.user_events.find({event_type: "purchase"})
```

3. **Count Documents**: Count the total number of documents.

```shell
db.user_events.countDocuments()
```

4. Find by Date Range: Find events within a specific time range.

```shell
db.user_events.find({
  event_time: {
    $gte: new Date("2024-01-01T00:00:00Z"),
    $lt: new Date("2024-02-01T00:00:00Z")
  }
})
```

5. **Sort Results**: Sort events by event_time.

```shell
db.user_events.find().sort({event_time: -1})
```

6. **Limit Results**: Limit the number of returned documents.

```shell
db.user_events.find().limit(10)
```

7. **Skip Results**: Skip a certain number of documents.

```shell
db.user_events.find().skip(1000)
```

8. **Projection**: Select specific fields to return.

```shell
db.user_events.find({}, {event_time: 1, event_type: 1})
```

9. **Update Document**: Update a document based on a condition.

```shell
db.user_events.updateOne(
  {user_id: 12345},
  {$set: {"user_session": "newSessionId"}}
)
```

10. **Delete Document**: Delete a document based on a condition.

```shell
db.user_events.deleteOne({user_id: 12345})
```

11. **Group By Category**: Group events by category_id and count occurrences.

```shell
db.user_events.aggregate([
  {$group: {_id: "$category_id", count: {$sum: 1}}}
])
```

12. **Average Price**: Calculate the average price of products.

```shell
db.user_events.aggregate([
  {$group: {_id: null, avgPrice: {$avg: "$price"}}}
])
```

13. **Max and Min Values**: Find the maximum and minimum values of price.

```shell
db.user_events.aggregate([
  {$group: {_id: null, maxPrice: {$max: "$price"}, minPrice: {$min: "$price"}}}
])
```

14. **Filter and Project**: Filter events by event_type and project specific fields.

```shell
db.user_events.aggregate([
  {$match: {event_type: "purchase"}},
  {$project: {_id: 0, event_time: 1, event_type: 1}}
])
```

15. **Unwind Array**: Unwind an array field (assuming user_session can be an array).

```shell
db.user_events.aggregate([
  {$unwind: "$user_session"},
  {$group: {_id: "$user_id", sessions: {$push: "$user_session"}}}
])
```

16. **Lookup**: Perform a join-like operation between collections (assuming another collection exists).

```shell
db.user_events.aggregate([
  {$lookup: {
      from: "anotherCollection",
      localField: "product_id",
      foreignField: "id",
      as: "product_info"
    }
  },
  {$unwind: "$product_info"}
])
```

17. **Conditional Aggregation**: Use `$cond` for conditional logic.

```shell
db.user_events.aggregate([
  {$group: {
      _id: "$event_type",
      total: {$sum: {$cond: [{$eq: ["$event_type", "purchase"]}, 1, 0]}}
    }
  }
])
```

18. **Array Concatenation**: Concatenate arrays using `$concatArrays`.

```shell
db.user_events.aggregate([
  {$addFields: {
      combinedTags: {$concatArrays: [["tag1", "tag2"], ["tag3", "tag4"]]}
    }
  }
])
```

19. **Date Truncation**: Truncate dates to the day.

```shell
db.user_events.aggregate([
  {$addFields: {
      truncatedEventTime: {$dateToString: {format: "%Y-%m-%d", date: "$event_time"}}
    }
  }}
])
```

20. **String Manipulation**: Convert string to lowercase.

```shell
db.user_events.aggregate([
  {$addFields: {
      lowerBrand: {$toLower: "$brand"}
    }
  }}
])
```

21. **Array Length**: Calculate the length of an array (assuming tags is an array).

```shell
db.user_events.aggregate([
  {$addFields: {
      tagLength: {$size: "$tags"}
    }
  }}
])
```

22. **Set Difference**: Find elements in one array not present in another (assuming tags and other_tags are arrays).

```shell
db.user_events.aggregate([
  {$project: {
      uniqueTags: {$setDifference: ["$tags", "$other_tags"]}
    }
  }}
])
```

23. **Array Intersection**: Find common elements in two arrays (assuming tags and other_tags are arrays).

```shell
db.user_events.aggregate([
  {$project: {
      commonTags: {$setIntersection: ["$tags", "$other_tags"]}
    }
  }}
])
```

24. **Array Union**: Combine two arrays (assuming tags and other_tags are arrays).

```shell
db.user_events.aggregate([
  {$project: {
      combinedTags: {$setUnion: ["$tags", "$other_tags"]}
    }
  }}
])
```

25. **Array Zip**: Combine two arrays element-wise (assuming tags and other_tags are arrays).

```shell
db.user_events.aggregate([
  {$project: {
      zippedTags: {$zip: {
          inputs: ["$tags", "$other_tags"],
          useLongestLength: true
        }}
    }
  }}
])
```
