# Elasticsearch Query Statements

> [!NOTE]
> These query statements were generated by [phind](https://www.phind.com/) to explore different aspects of Elasticsearch.

1. Basic Search Query

   - Objective: Retrieve all products.
   - Key Points: Understanding the basics of querying Elasticsearch.

```json
GET /products/_search
{
  "query": {
    "match_all": {}
  }
}
```

1. Full-Text Search

    - Objective: Find products by title.
    - Key Points: Introduction to full-text search capabilities.

```json
GET /products/_search
{
  "query": {
    "match": {
      "title": "example product"
    }
  }
}
```

3. Multi-Match Query

    - Objective: Search both title and description for matches.
    - Key Points: Searching multiple fields simultaneously.

```json
GET /products/_search
{
  "query": {
    "multi_match": {
      "query": "example",
      "fields": ["title", "description"]
    }
  }
}
```

4. Boolean Query

    - Objective: Find electronics with high ratings, optionally Apple-branded.
    - Key Points: Combining conditions with must, should, and must_not.

```json
GET /products/_search
{
  "query": {
    "bool": {
      "must": [
        { "match": { "category": "electronics" } },
        { "range": { "average_rating": { "gt": 4 } } }
      ],
      "should": [
        { "match": { "brand": "Apple" } }
      ]
    }
  }
}
```

5. Term Query

    - Objective: Exact match on category field.
    - Key Points: Using .keyword for exact matches.

```json
GET /products/_search
{
  "query": {
    "term": {
      "category.keyword": "electronics"
    }
  }
}
```

6. Range Query

    - Objective: Find products within a price range.
    - Key Points: Filtering based on numeric ranges.

```json
GET /products/_search
{
  "query": {
    "range": {
      "actual_price": {
        "gte": 100,
        "lte": 500
      }
    }
  }
}
```

7. Filtered Query

    - Objective: List products that are in stock.
    - Key Points: Using filters for efficiency.

```json
GET /products/_search
{
  "query": {
    "bool": {
      "filter": [
        { "term": { "out_of_stock": false } }
      ]
    }
  }
}
```

8. Aggregation - Count Products per Category

    - Objective: Group products by category.
    - Key Points: Introduction to aggregations for insights.

```json
GET /products/_search
{
  "size": 0,
  "aggs": {
    "categories": {
      "terms": {
        "field": "category"
      }
    }
  }
}
```

9. Sorting Results

    - Objective: Sort products by average rating.
    - Key Points: Customizing sort orders.

```json
GET /products/_search
{
  "query": {
    "match_all": {}
  },
  "sort": [
    { "average_rating": "desc" }
  ]
}
```

10. Pagination

    - Objective: Implement pagination to limit results.
    - Key Points: Controlling the number of results returned.

```json
GET /products/_search
{
  "from": 0,
  "size": 10,
  "query": {
    "match_all": {}
  }
}
```

11. Highlighting

    - Objective: Highlight search terms in the title.
    - Key Points: Improving search result readability.

```json
GET /products/_search
{
  "query": {
    "match": {
      "title": "example product"
    }
  },
  "highlight": {
    "fields": {
      "title": {}
    }
  }
}
```

12. Script Query

    - Objective: Boost documents based on average rating.
    - Key Points: Dynamic scoring based on document content.

```json
GET /products/_search
{
  "query": {
    "script_score": {
      "query": {"match_all": {}},
      "script": {
        "source": "doc['average_rating'].value * 100"
      }
    }
  }
}
```

13. More Like This (MLT)

    - Objective: Find similar products based on details.
    - Key Points: Discovering related items automatically.

```json
GET /products/_search
{
  "query": {
    "more_like_this": {
      "fields": ["product_details"],
      "like": [{"_index": "products", "_id": "1"}]
    }
  }
}
```

14. Nested Query

    - Objective: Search within nested arrays.
    - Key Points: Handling complex, nested data structures.

```json
GET /products/_search
{
  "query": {
    "nested": {
      "path": "images",
      "query": {
        "match": {
          "images.url": "example.jpg"
        }
      }
    }
  }
}
```

(Assuming images is an array of objects, each containing url.)

15. Prefix Query

    - Objective: Find sellers starting with a specific prefix.
    - Key Points: Efficient searching of text prefixes.

```json
GET /products/_search
{
  "query": {
    "prefix": {
      "seller": "SellerA"
    }
  }
}
```

16. Exists Query

    - Objective: Find products with a discount.
    - Key Points: Checking for the existence of a field.

```json
GET /products/_search
{
  "query": {
    "exists": {
      "field": "discount"
    }
  }
}
```

17. Missing Query

    - Objective: Find products without a discount.
    - Key Points: Identifying documents missing certain fields.

```json
GET /products/_search
{
  "query": {
    "missing": {
      "field": "discount"
    }
  }
}
```

18. Date Range Query

    - Objective: Find products crawled within a specific date range.
    - Key Points: Working with dates for filtering.

```json
GET /products/_search
{
  "query": {
    "range": {
      "crawled_at": {
        "gte": "2023-01-01",
        "lt": "2023-02-01"
      }
    }
  }
}
```

19. Function Score Query

    - Objective: Dynamically adjust scores based on time decay.
    - Key Points: Advanced scoring mechanisms.

```json
GET /products/_search
{
  "query": {
    "function_score": {
      "query": {"match_all": {}},
      "functions": [
        {
          "exp": {
            "average_rating": {
              "origin": "now",
              "scale": "1 week ago"
            }
          }
        }
      ],
      "score_mode": "sum"
    }
  }
}
```

20. Top Hits

    - Objective: Retrieve top hits based on sorting criteria.
    - Key Points: Extracting snippets of documents.

```json
GET /products/_search
{
  "query": {
    "top_hits": {
      "size": 1,
      "_source": ["title", "price"],
      "sort": [
        {"_key": {"order": "asc"}}
      ]
    }
  }
}
```

21. Query String

    - Objective: Perform a flexible search using wildcards.
    - Key Points: Wildcard searches for flexibility.

```json
GET /products/_search
{
  "query": {
    "query_string": {
      "default_field": "title",
      "query": "*example*"
    }
  }
}
```

22. Inverse Document Frequency (IDF)

    - Objective: Adjust scores based on IDF for a specific category.
    - Key Points: Enhancing relevance for specific categories.

```json
GET /products/_search
{
  "query": {
    "function_score": {
      "query": {"match_all": {}},
      "functions": [
        {
          "filter": {
            "term": {
              "category.keyword": "electronics"
            }
          },
          "weight": 2,
          "random_score": {},
          "boost_mode": "replace"
        }
      ],
      "max_boost": 42,
      "score_mode": "multiply",
      "boost_mode": "replace"
    }
}
```

23. Constant Score Query

    - Objective: Ensure a constant score for documents matching the filter.
    - Key Points: Maintaining consistent scoring for filtered results.

```json
GET /products/_search
{
  "query": {
    "constant_score": {
      "filter": {
        "term": {
          "out_of_stock": false
        }
      }
    }
  }
}
```

24. Range Step Query

    - Objective: Find products within a stepped range.
    - Key Points: Customized range queries for specific needs.

```json
GET /products/_search
{
  "query": {
    "range_step_query": {
      "field": "actual_price",
      "step": 50,
      "gte": 200,
      "lte": 800
    }
  }
}
```

25. Composite Aggregation

    - Objective: Aggregate products by brand and category.
    - Key Points: Complex aggregations for deeper insights.

```json
GET /products/_search
{
  "size": 0,
  "aggs": {
    "by_brand_and_category": {
      "composite": {
        "size": 10,
        "sources": [
          { "brand": { "terms": { "field": "brand" } } },
          { "category": { "terms": { "field": "category" } } }
        ]
      }
    }
  }
}
```
