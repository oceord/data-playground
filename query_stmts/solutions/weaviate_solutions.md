# Weaviate Query statements

> [!NOTE]
> These query statements were partially generated by [phind](https://www.phind.com/) to explore different aspects of Weaviate.

## Embedding Your Dataset

- Option 1 - Have Weaviate create vectors for you
  - Define a schema for the dataset and ensure the descriptions are embedded

```python
collection_config = {
    "name": "YourCollectionName",
    "properties": [
        {"name": "id", "dataType": ["uuid"]},
        {"name": "category", "dataType": ["string"]},
        {"name": "description", "dataType": ["text"]}
    ],
    "vectorizers": [
        Configure.NamedVectors.text2vec_openai(
            name="description_vector",
            source_properties=["description"]
        )
    ]
}

# Create the collection with the configured vectorizer
response = client.collections.create(**collection_config)
print(response)
```

- Option 2 - Specify custom vectors
  - Use vectors created by the client and not by Weaviate.

## Querying Weaviate

### Basic Queries

1. Find by ID

```python
response = requests.get(f"http://localhost:8080/v1/objects/{'your-class-id'}")
print(response.json())
```

2. Search by Category

```python
response = requests.get("http://localhost:8080/v1/search", params={"query": "category:Electronics"})
print(response.json())
```

### Advanced Queries

3. Semantic Search
    - First, enable semantic search if not already done.
    - Then, perform a semantic search using the semanticQuery parameter.

```python
response = requests.get("http://localhost:8080/v1/search", params={
    "query": "description:A fascinating novel.",
    "filters": [{"path": ["category"], "operator": "Equal", "value": "Books"}],
    "semanticQuery": True
})
print(response.json())
```

4. Vector Similarity Search
    - After embedding, you can find similar items based on vectors.

```python
# Assuming you have a vector for the query
query_vector = [0.1, 0.2, 0.3]  # Placeholder, replace with actual vector
response = requests.post("http://localhost:8080/v1/similar", json={"vector": query_vector})
print(response.json())
```

5. Classification
    - Weaviate supports classification models. You'd typically train a model outside Weaviate and then use it within queries.

```python
# This is a conceptual example; actual implementation depends on your classifier setup
response = requests.post("http://localhost:8080/v1/classify", json={
    "objectIds": ["your-object-id"],
    "modelId": "your-model-id"
})
print(response.json())
```

6. Question-Answer Extraction
    - Extract answers to specific questions about your objects.

```python
response = requests.post("http://localhost:8080/v1/question-answer-extraction", json={
    "question": "What is the category of the object?",
    "objectIds": ["your-object-id"]
})
print(response.json())
```

7. Combining Filters and Sorting
    - Combine filters and sort results.

```python
response = requests.get("http://localhost:8080/v1/search", params={
    "query": "category:Electronics",
    "sort": [{"path": ["id"], "order": "desc"}]
})
print(response.json())
```

8. Pagination
    - Use pagination to handle large result sets.

```python
response = requests.get("http://localhost:8080/v1/search", params={
    "query": "category:Electronics",
    "pageSize": 10,
    "page": 1
})
print(response.json())
```

9. Aggregation
    - Aggregate properties across objects.

```python
response = requests.get("http://localhost:8080/v1/aggregations", params={
    "aggregations": [{"propertyPath": "category", "type": "count"}]
})
print(response.json())
```

10. Faceted Search
    - Perform faceted search to get insights into categories or other properties.

```python
response = requests.get("http://localhost:8080/v1/facets", params={
    "path": ["category"]
})
print(response.json())
```

11. Text Analysis
    - Analyze text content for sentiment or topics.

```python
response = requests.post("http://localhost:8080/v1/text-analysis", json={
    "text": "This product is amazing!",
    "analysisType": "sentiment"
})
print(response.json())
```

12. Custom Functions
    - Execute custom functions on your data.

```python
response = requests.post("http://localhost:8080/v1/functions", json={
    "functionName": "customFunction",
    "parameters": {"param1": "value1"}
})
print(response.json())
```

13. Join Objects
    - Join objects based on relationships defined in your schema.

```python
response = requests.get("http://localhost:8080/v1/joins", params={
    "from": "YourClass",
    "to": "RelatedClass",
    "where": {"path": ["relatedProperty"], "operator": "Equal", "value": "someValue"}
})
print(response.json())
```

14. Filter by Vector Distance
    - Find objects within a certain distance from a vector.

```python
response = requests.post("http://localhost:8080/v1/filter-by-vector-distance", json={
    "vector": [0.1, 0.2, 0.3],  # Placeholder, replace with actual vector
    "distance": 0.5
})
print(response.json())
```

15. Batch Operations
    - Perform batch operations like updating or deleting multiple objects.

```python
update_payload = {
    "objects": [
        {"id": "object-id-1", "properties": {"description": "New description"}},
        {"id": "object-id-2", "properties": {"category": "Updated Category"}}
    ]
}
response = requests.post("http://localhost:8080/v1/batch", json=update_payload)
print(response.json())
```

16. Data export
    - Export data in various formats.

```python
export_response = requests.get("http://localhost:8080/v1/export", params={
    "format": "json"
})
print(export_response.text)
```

17. Data Import
    - Import data from external sources.

```python
import_response = requests.post("http://localhost:8080/v1/import", files={
    'file': ('data.csv', open('data.csv', 'rb'), 'application/octet-stream')
})
print(import_response.status_code)
```

18. Schema Management
    - Manage your schema, including adding new classes or properties.

```python
add_property_response = requests.post("http://localhost:8080/v1/schema", json={
    "classes": [
        {
            "class": "NewClass",
            "properties": [
                {"name": "newProperty", "dataType": ["string"]}
            ]
        }
    ]
})
print(add_property_response.json())
```

19. Security and Permissions
    - Manage access control lists (ACLs) for secure data access.

```python
acl_response = requests.put("http://localhost:8080/v1/acl", json={
    "acl": {
        "permissions": [
            {"action": "read", "filter": {"path": ["*"], "operator": "Equal", "value": "admin"}}
        ],
        "rules": [
            {"id": "rule1", "actions": ["read"]}
        ]
    }
})
print(acl_response.json())
```

20. Monitoring and Health Checks
    - Check the health status of your Weaviate instance.

```python
health_check_response = requests.get("http://localhost:8080/v1/health")
print(health_check_response.json())
```

21. Backup and Restore
    - Backup and restore your Weaviate instance.

```python
backup_response = requests.get("http://localhost:8080/v1/backup")
print(backup_response.json())
```

22. Scaling and Performance Tuning
    - Adjust settings for better performance.

```python
scale_response = requests.put("http://localhost:8080/v1/config", json={
    "config": {
        "maxObjectsPerRequest": 500
    }
})
print(scale_response.json())
```

23. Custom Modules
    - Extend Weaviate with custom modules.

```python
module_install_response = requests.post("http://localhost:8080/v1/modules/install", json={
    "module": "custom-module-name",
    "version": "1.0.0"
})
print(module_install_response.json())
```
